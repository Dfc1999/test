<app-header></app-header>

<div class="hotel-detail-container" *ngIf="hotel">
  <div *ngIf="hotel.images?.length" class="carousel-wrapper">
    <div class="carousel">
      <div
        class="carousel-slide"
        *ngFor="let image of hotel.images; let i = index"
        [class.active]="i === currentSlide"
      >
        <img [src]="image.url" alt="Hotel Image" class="carousel-img" />
      </div>
      <button class="prev" (click)="prevSlide()">
        <mat-icon>chevron_left</mat-icon>
      </button>
      <button class="next" (click)="nextSlide()">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>
  </div>

  <section class="hotel-info">
    <div class="hotel-header">
      <h1>{{ hotel.name }}</h1>
      <div class="stars">
        <mat-icon *ngFor="let star of [].constructor(hotel.starRating)">star</mat-icon>
      </div>
    </div>

    <p class="location">
      <mat-icon>location_on</mat-icon>
      {{ hotel.location.city }}, {{ hotel.location.country }}
    </p>

    <h2>About this hotel</h2>
    <p class="description">{{ hotel.description | fallbackPipe:'No description available' }}</p>


    <h2>Amenities</h2>
    <div class="amenities">
      <span *ngFor="let amenity of hotel.amenities">
        <mat-icon color="primary">check_circle</mat-icon> {{ amenity }}
      </span>
    </div>

    <h2>Rooms</h2>
    <div *ngIf="rooms.length > 0; else noRooms" class="rooms-list">
      <div *ngFor="let room of rooms" class="room-card">
        <h3>{{ room.type | capitalizePipe }} - {{ room.beds }} beds</h3>
        <p>{{ room.description }}</p>
        <p>Capacity: {{ room.capacity }} guests</p>
        <p>Price per night: {{ room.price | pricePipe }}</p>

        <div class="room-controls">
          <button mat-icon-button (click)="decrementRoom(room._id)">
            <mat-icon>remove_circle_outline</mat-icon>
          </button>
          <mat-form-field appearance="outline" class="quantity-field">
            <input matInput type="number" min="0" [value]="getRoomQuantity(room._id)" readonly />
          </mat-form-field>
          <button mat-icon-button (click)="incrementRoom(room._id)">
            <mat-icon>add_circle_outline</mat-icon>
          </button>
        </div>
      </div>
    </div>
    <ng-template #noRooms>
      <p>No rooms available</p>
    </ng-template>

    <div class="action-buttons">
      <button mat-raised-button color="primary" [disabled]="!isAnyRoomSelected() || !checkIn || !checkOut" #proceedButton>
        Proceed with Booking
      </button>
    </div>  

    @defer (on interaction(proceedButton)) {
      <app-booking-form
        [hotelId]="hotel?._id"
        [roomSelections]="roomSelections"
        [checkIn]="checkIn"
        [checkOut]="checkOut"
        (bookingCompleted)="onBookingCompleted()"
        (bookingCancelled)="onBookingCancelled()"
      ></app-booking-form>
    } @placeholder {
      <p>Loading booking form...</p>
    }


    <div class="booking-section">
      <mat-form-field appearance="fill">
        <mat-label>Check-in</mat-label>
        <input matInput [(ngModel)]="checkIn" [matDatepicker]="pickerIn" />
        <mat-datepicker-toggle matSuffix [for]="pickerIn"></mat-datepicker-toggle>
        <mat-datepicker #pickerIn></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Check-out</mat-label>
        <input matInput [(ngModel)]="checkOut" [matDatepicker]="pickerOut" />
        <mat-datepicker-toggle matSuffix [for]="pickerOut"></mat-datepicker-toggle>
        <mat-datepicker #pickerOut></mat-datepicker>
      </mat-form-field>
    </div>
  </section>
</div>

<app-footer></app-footer>