<section class="availability-section">
  <h2>Available Rooms</h2>
  @if (isLoading()) {
    <p>Loading availability...</p>
  } @else {
    @if (!selectedRoomType()) {
      @if (roomSummary().length > 0) {
        <div class="rooms-grid">
          @for (summary of roomSummary(); track summary.type) {
            <mat-card class="room-summary-card">
              <mat-card-header>
                <mat-card-title>{{ summary.type | capitalizePipe }}</mat-card-title>
                <mat-card-subtitle>{{ summary.availableCount }} available</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <p>From {{ summary.price | pricePipe }} / night</p>
              </mat-card-content>
              <mat-card-actions>
                <button mat-button color="primary" (click)="viewDetails.emit(summary.type)">VIEW ROOMS</button>
              </mat-card-actions>
            </mat-card>
          }
        </div>
      } @else {
        <p>No rooms available for the selected dates. Please try other dates.</p>
      }
    } @else {
      <div class="detailed-view">
        <button mat-stroked-button (click)="back.emit()">
          <mat-icon>arrow_back</mat-icon>
          Back to Summary
        </button>
        <h3>{{ selectedRoomType()! | capitalizePipe }} Rooms</h3>
        <div class="rooms-grid">
          @for (room of detailedRooms(); track room._id) {
            <mat-card class="detailed-room-card" [class.selected]="isRoomSelected(room._id)">
              <mat-card-header>
                <mat-card-title>Room {{ room.roomNumber }}</mat-card-title>
                <mat-card-subtitle>{{ room.beds }} beds, for {{ room.capacity }} guests</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <p>{{ room.description }}</p>
                <p class="price">{{ room.price | pricePipe }} / night</p>
              </mat-card-content>
              <mat-card-actions>
                <button mat-stroked-button (click)="toggleSelection.emit(room._id)">
                  {{ isRoomSelected(room._id) ? 'DESELECT' : 'SELECT' }}
                </button>
              </mat-card-actions>
            </mat-card>
          }
        </div>
      </div>
    }
  }
</section>